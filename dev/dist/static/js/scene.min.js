"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Scene=e()}(void 0,(function(){
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
    See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */
var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};function e(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}function n(t,e,n){var i=1-n;return n*n*n+3*n*n*i*e+3*n*i*i*t}function i(t,e,i,r){var s=function(s){var a=function(t,e,i){for(var r=i,s=1;Math.abs(s)>.001;){if(s=n(t,e,r)-i,Math.abs(s)<.001)return r;r-=s/2}return r}(t,i,Math.max(Math.min(1,s),0));return n(e,r,a)};return s.easingName="cubic-bezier("+t+","+e+","+i+","+r+")",s}function r(t,e){var n=function(n){var i=1/t;return n>=1?1:("start"===e?i:0)+Math.floor(n/i)*i};return n.easingName="steps("+t+", "+e+")",n}var s,a=r(1,"start"),o=r(1,"end"),u=i(0,0,1,1),f=i(.25,.1,.25,1),c=i(.42,0,1,1),h=i(0,0,.58,1),l=i(.42,0,.58,1),p="animation-timing-function",v={transform:{},filter:{},attribute:{},html:!0},m={easing:[p]},d=((s={})[p]=!0,s.contents=!0,s.html=!0,s),g="delay",y={linear:u,ease:f,"ease-in":c,"ease-out":h,"ease-in-out":l,"step-start":a,"step-end":o},S=["duration","fillMode","direction","iterationCount",g,"easing","playSpeed"],E=["paused","ended","timeupdate","animate","play","iteration"],b=["rgb","rgba","hsl","hsla"],w="undefined"!==("undefined"==typeof window?"undefined":_typeof(window)),T="undefined"!==("undefined"==typeof document?"undefined":_typeof(document))&&document,x=["webkit","ms","moz","o"],F=function(t){if(!T)return"";var e=(T.body||T.documentElement).style,n=x.length;if("undefined"!==_typeof(e[t]))return t;for(var i=0;i<n;++i){var r="-"+x[i]+"-"+t;if("undefined"!==_typeof(e[r]))return r}return""},C=F("transform"),I=F("filter"),_=F("animation"),A=_.replace("animation","keyframes");function D(t,e,n,i){return(t*i+e*n)/(n+i)}function j(t){return"undefined"===_typeof(t)}function N(t){return t&&"object"===_typeof(t)}function O(t){return Array.isArray(t)}function M(t){return"string"===_typeof(t)}function k(t){return"function"===_typeof(t)}function P(t){var e=t.match(/("[^"]*"|'[^']*'|[^,\s()]*\((?:[^()]*|\([^()]*\))*\)[^,\s()]*|[^,])+/g);return e?e.map((function(t){return t.trim()})):[]}function U(t){var e=/([^(]*)\(([\s\S]*)\)([\s\S]*)/g.exec(t);return!e||e.length<4?{}:{prefix:e[1],value:e[2],suffix:e[3]}}function K(t){var e=/^([^\d|e|\-|\+]*)((?:\d|\.|-|e-|e\+)+)(\S*)$/g.exec(t);if(!e)return{prefix:"",unit:"",value:NaN};var n=e[1],i=e[2];return{prefix:n,unit:e[3],value:parseFloat(i)}}function R(t){return t.replace(/[\s-_]([a-z])/g,(function(t,e){return e.toUpperCase()}))}function z(t,e){return void 0===e&&(e="-"),t.replace(/([a-z])([A-Z])/g,(function(t,n,i){return""+n+e+i.toLowerCase()}))}function L(t){return[].slice.call(t)}function V(){return Date.now?Date.now():(new Date).getTime()}function $(t,e,n){void 0===n&&(n=-1);for(var i=t.length,r=0;r<i;++r)if(e(t[r],r,t))return r;return n}function q(t,e,n){var i=$(t,e);return i>-1?t[i]:n}var Z=function(){var t=V(),e=w&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame);return e?e.bind(window):function(e){var n=V();return window.setTimeout((function(){e(n-t)}),1e3/60)}}(),J=function(){var t=w&&(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame);return t?t.bind(window):function(t){clearTimeout(t)}}();function Y(t){var e=function(t){return t.replace("#","")}(t),n=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16),s=parseInt(e.substring(6,8),16)/255;return isNaN(s)&&(s=1),[n,i,r,s]}function H(t){if("#"===t.charAt(0))return 4===t.length||5===t.length?Y((f=(u=t).charAt(1),c=u.charAt(2),h=u.charAt(3),l=u.charAt(4),["#",f,f,c,c,h,h,l,l].join(""))):Y(t);if(-1!==t.indexOf("(")){var e=U(t),n=e.prefix,i=e.value;if(!n||!i)return;var r=P(i),s=[],a=r.length;switch(n){case"rgb":case"rgba":for(var o=0;o<a;++o)s[o]=parseFloat(r[o]);return s;case"hsl":case"hsla":for(o=0;o<a;++o)-1!==r[o].indexOf("%")?s[o]=parseFloat(r[o])/100:s[o]=parseFloat(r[o]);return function(t){var e=t[0],n=t[1],i=t[2];e<0&&(e+=360*Math.floor((Math.abs(e)+360)/360)),e%=360;var r,s=(1-Math.abs(2*i-1))*n,a=s*(1-Math.abs(e/60%2-1)),o=i-s/2;return e<60?r=[s,a,0]:e<120?r=[a,s,0]:e<180?r=[0,s,a]:e<240?r=[0,a,s]:e<300?r=[a,0,s]:e<360&&(r=[s,0,a]),[Math.round(255*(r[0]+o)),Math.round(255*(r[1]+o)),Math.round(255*(r[2]+o)),t.length>3?t[3]:1]}(s)}}var u,f,c,h,l}function X(t,e){return e?T.querySelectorAll(t):T.querySelector(t)}function B(t,e){t.classList?t.classList.add(e):t.className+=" "+e}function G(t,e){if(t.classList)t.classList.remove(e);else{var n=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(n," ")}}function Q(t,e,n,i){t.addEventListener(e,n,i)}function W(t,e,n){t.removeEventListener(e,n)}var tt=function(){function t(){this.events={}}var e=t.prototype;return e._on=function(t,e,n){var i=this,r=this.events;if(N(t))for(var s in t)this._on(s,t[s],n);else t in r||(r[t]=[]),e&&(O(e)?e.forEach((function(e){return i._on(t,e,n)})):r[t].push(n?function n(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];e.apply(void 0,i),this.off(t,n)}:e))},e.on=function(t,e){return this._on(t,e),this},e.off=function(t,e){if(t)if(e){var n=this.events[t];if(!n)return this;var i=n.indexOf(e);-1!==i&&n.splice(i,1)}else this.events[t]=[];else this.events={};return this},e.trigger=function(t){for(var e=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var r=this.events;if(!(t in r))return this;var s=n||[];!s[0]&&(s[0]={});r[t];var a=s[0];return a.type=t,a.currentTarget=this,!a.target&&(a.target=this),L(r[t]).forEach((function(t){t.apply(e,n)})),this},e.once=function(t,e){return this._on(t,e,!0),this},t}(),et=function(){function t(t,e){this.prefix="",this.suffix="",this.model="",this.type="",this.separator=",",e&&this.setOptions(e),this.value=M(t)?t.split(this.separator):t}var e=t.prototype;return e.setOptions=function(t){for(var e in t)this[e]=t[e];return this},e.size=function(){return this.value.length},e.get=function(t){return this.value[t]},e.set=function(t,e){return this.value[t]=e,this},e.clone=function(){var e=this,n=e.separator,i=e.prefix,r=e.suffix,s=e.model,a=e.type;return new t(this.value.map((function(e){return e instanceof t?e.clone():e})),{separator:n,prefix:i,suffix:r,model:s,type:a})},e.toValue=function(){return this.prefix+this.join()+this.suffix},e.join=function(){return this.value.map((function(e){return e instanceof t?e.toValue():e})).join(this.separator)},e.forEach=function(t){return this.value.forEach(t),this},t}();function nt(t){for(var e=t.split(";"),n={},i=e.length,r=0;r<i;++r){var s=/([^:]*):([\S\s]*)/g.exec(e[r]);!s||s.length<3||!s[1]?--i:n[s[1].trim()]=st(s[2].trim())}return{styles:n,length:i}}function it(t){return 3===t.length&&(t[3]=1),new et(t,{model:"rgba",separator:",",type:"color",prefix:"rgba(",suffix:")"})}function rt(t,e){return new et(t,{type:"array",separator:e})}function st(t,e){if(!M(t))return O(t)?rt(t,","):t;var n=P(t);return n.length>1?rt(n.map((function(t){return st(t)})),","):(n=t.match(/("[^"]*")|('[^']*')|([^\s()]*(?:\((?:[^()]*|\([^()]*\))*\))[^\s()]*)|\S+/g)||[]).length>1?rt(n.map((function(t){return st(t)}))," "):(n=/^(['"])([^'"]*)(['"])$/g.exec(t))&&n[1]===n[3]?new et([st(n[2])],{prefix:n[1],suffix:n[1]}):-1!==t.indexOf("(")?function(t){var e=U(t),n=e.prefix,i=e.value,r=e.suffix;if(void 0===i)return t;if(b.indexOf(n)>-1)return it(H(t));var s=st(i,n),a=[i],o=",",u=n+"(",f=")"+r;return s instanceof et&&(o=s.separator,a=s.value,u+=s.prefix,f=s.suffix+f),new et(a,{separator:o,model:n,prefix:u,suffix:f})}(t):"#"===t.charAt(0)&&"url"!==e?function(t){var e=H(t);return e?it(e):t}(t):t}function at(t,e){void 0===e&&(e={});var n=t.model;if(n){t.setOptions({model:"",suffix:"",prefix:""});var i=t.size()>1?t:t.get(0);e[n]=i}else t.forEach((function(t){at(t,e)}));return e}function ot(t){return t instanceof et}function ut(t){var e=_typeof(t);if("object"===e){if(O(t))return"array";if(ot(t))return"property"}else if("string"===e||"number"===e)return"value";return e}function ft(t){return N(t)&&t.constructor===Object}function ct(t,e){var n=[];if(ft(t))for(var i in t)e.push(i),n=n.concat(ct(t[i],e)),e.pop();else n.push(e.slice());return n}function ht(t,e){for(var n in e){ft(e[n])?(N(t[n])||(t[n]={}),ht(t[n],e[n])):t[n]=!0}return t}function lt(t){return Math.round(1e6*t)/1e6}function pt(t,e,n){void 0===n&&(n=t.length);for(var i=e,r=0;r<n;++r){if(!N(i))return;i=i[t[r]]}return i}function vt(t,e,n){var i=e.length,r=t;if(0===i)return!1;for(var s=0;s<i;++s){if(!0===r)return!1;if(!(r=r[e[s]])||!n&&!0===r)return!1}return!0}function mt(t,e){return vt(v,t,e)}function dt(t){return vt(d,t,!0)}function gt(t,e){t.state.playCSS=e}function yt(t){return t.state.playCSS&&t.isPaused()}function St(t){return!t.isEnded()&&t.state.playCSS}function Et(t,e){var n="__SCENEJS_STYLE_"+Tt(t),i=X("#"+n);i?i.innerText=e:T.body.insertAdjacentHTML("beforeend",'<style id="'+n+'">'+e+"</style>")}function bt(t){for(;;){var e=""+Math.floor(1e7*Math.random());if(!w||!t)return e;if(!X('[data-scene-id="'+e+'"]'))return e}}function wt(t){return t.getId()||t.setId(bt(!1)).getId()}function Tt(t){return(""+t).match(/[0-9a-zA-Z]+/g).join("")}function xt(t,e,n,i){if(void 0===i&&(i={}),_&&"running"!==t.getPlayState()){var r=n||"startAnimation";if(yt(t))t.addPlayClass(!0,r,i);else{t.isEnded()&&t.setTime(0),e&&t.exportCSS({className:r});var s=t.addPlayClass(!1,r,i);if(!s)return;!function(t,e){var n=t.state,i=t.getDuration(),r=!i||!isFinite(i),s=function(){gt(t,!1),t.finish()},a=function(){t.trigger("play")};t.once("ended",(function(){W(e,"animationcancel",s),W(e,"animationend",s),W(e,"animationiteration",o),W(e,"animationstart",a)}));var o=function(e){var s=e.elapsedTime,a=r?0:s/i;n.currentTime=s,t.setIteration(a)};Q(e,"animationcancel",s),Q(e,"animationend",s),Q(e,"animationiteration",o),Q(e,"animationstart",a)}(t,s),gt(t,!0)}t.setPlayState("running")}}function Ft(t){var e;if(M(t))if(t in y)e=y[t];else{var n=st(t);if(M(n))return 0;if("cubic-bezier"===n.model)e=i((t=n.value.map((function(t){return parseFloat(t)})))[0],t[1],t[2],t[3]);else{if("steps"!==n.model)return 0;e=r(parseFloat(n.value[0]),n.value[1])}}else e=O(t)?i(t[0],t[1],t[2],t[3]):t;return e}function Ct(t,e,n){return"reverse"===n||("infinite"!==e&&t===e&&e%1==0?n===(t%2>=1?"alternate-reverse":"alternate"):n===(t%2>=1?"alternate":"alternate-reverse"))}var It=["id","iterationCount",g,"fillMode","direction","playSpeed","duration","playSpeed","iterationTime","playState"],_t=It.concat(["easing","easingName"]),At=function(t){function n(e){var n=t.call(this)||this;return n.timerId=0,n.state={id:"",easing:0,easingName:"linear",iterationCount:1,delay:0,fillMode:"forwards",direction:"normal",playSpeed:1,currentTime:0,iterationTime:-1,iteration:0,tickTime:0,prevTime:0,playState:"paused",duration:0},n.setOptions(e),n}e(n,t);var i,r,s,a=n.prototype;return a.setEasing=function(t){var e=Ft(t),n=e&&e.easingName||"linear",i=this.state;return i.easing=e,i.easingName=n,this},a.setOptions=function(t){for(var e in void 0===t&&(t={}),t){var n=t[e];"easing"!==e?"duration"!==e?S.indexOf(e)>-1&&(this.state[e]=n):n&&this.setDuration(n):this.setEasing(n)}return this},a.getTotalDuration=function(){return this.getActiveDuration(!0)},a.getActiveDuration=function(t){var e=this.state,n=e.iterationCount;return"infinite"===n?1/0:(t?e.delay:0)+this.getDuration()*n},a.isEnded=function(){return 0===this.state.tickTime&&"paused"===this.state.playState||!(this.getTime()<this.getActiveDuration())},a.isPaused=function(){return"paused"===this.state.playState},a.start=function(t){void 0===t&&(t=this.state.delay);var e=this.state;return e.playState="running",e.tickTime>=t&&(this.trigger("play"),!0)},a.play=function(t){var e=this,n=this.state,i=n.delay,r=this.getTime();return n.playState="running",this.isEnded()&&(0===r||r>=this.getActiveDuration())&&this.setTime(-i,!0),this.timerId=Z((function(i){n.prevTime=i,e.tick(i,t)})),this.start(),this},a.pause=function(){var t=this.state;return"paused"!==t.playState&&(t.playState="paused",this.trigger("paused")),J(this.timerId),this},a.finish=function(){return this.setTime(0),this.state.tickTime=0,this.end(),this},a.end=function(){return this.pause(),this.trigger("ended"),this},a.setTime=function(t,e,n){var i=this.getActiveDuration(),r=this.state,s=r.tickTime,a=r.delay,o=e?t:this.getUnitTime(t);if(r.tickTime=a+o,o<0?o=0:o>i&&(o=i),r.currentTime=o,this.calculate(),e&&!n){var u=r.tickTime;if(s<a&&t>=0&&this.start(0),u<s||this.isEnded())return void this.end()}return this.isDelay()?this:(this.trigger("timeupdate",{currentTime:o,time:this.getIterationTime(),iterationCount:r.iteration}),this)},a.getTime=function(){return this.state.currentTime},a.getUnitTime=function(t){if(M(t)){var e=this.getDuration()||100;if("from"===t)return 0;if("to"===t)return e;var n=K(t),i=n.unit,r=n.value;return"%"===i?(!this.getDuration()&&this.setDuration(e),lt(parseFloat(t)/100*e)):">"===i?r+1e-6:r}return lt(t)},a.isDelay=function(){var t=this.state,e=t.delay,n=t.tickTime;return e>0&&n<e},a.setIteration=function(t){var e=this.state,n=Math.floor(t),i="infinite"===e.iterationCount?1/0:e.iterationCount;return e.iteration<n&&n<i&&this.trigger("iteration",{currentTime:e.currentTime,iterationCount:n}),e.iteration=t,this},a.calculate=function(){var t=this.state,e=t.iterationCount,n=t.fillMode,i=t.direction,r=this.getDuration(),s=this.getTime(),a=0===r?0:s/r,o=r?s%r:0;if(!r)return this.setIterationTime(0),this;this.setIteration(a);var u=Ct(a,e,i),f=isFinite(r);(f&&u&&(o=r-o),f&&"infinite"!==e)&&(a>=e&&(o=r*("both"===n||"forwards"===n?e%1||1:0),u&&(o=r-o)));return this.setIterationTime(o),this},a.tick=function(t,e){var n=this;if(!this.isPaused()){var i=this.state,r=i.playSpeed,s=i.prevTime,a=i.delay,o=i.tickTime+Math.min(1e3,t-s)/1e3*r;i.prevTime=t,this.setTime(o-a,!0),e&&1e3*e<t&&this.pause(),"paused"!==i.playState&&(this.timerId=Z((function(t){n.tick(t,e)})))}},n=function(t,e,n,i){var r,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var o=t.length-1;o>=0;o--)(r=t[o])&&(a=(s<3?r(a):s>3?r(e,n,a):r(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}([(i=_t,r=It,s="state",function(t){var e=t.prototype;i.forEach((function(t){e[R("get "+t)]=function(){return this[s][t]}})),r.forEach((function(t){e[R("set "+t)]=function(e){return this[s][t]=e,this}}))})],n)}(tt);function Dt(t){if(!t)return"";var e=[];for(var n in t)e.push(n.replace(/\d$/g,"")+"("+t[n]+")");return e.join(" ")}function jt(t,e){return void 0===e&&(e=!1),Nt({},t,e)}function Nt(t,e,n){for(var i in void 0===n&&(n=!1),e){var r=e[i],s=ut(r);"property"===s?t[i]=n?r.toValue():r.clone():"function"===s?t[i]=n?Mt([i],r):r:"array"===s?t[i]=r.slice():"object"===s?N(t[i])&&!ot(t[i])?Nt(t[i],r,n):t[i]=jt(r,n):t[i]=e[i]}return t}function Ot(t){return t[0]in m?m[t[0]]:t}function Mt(t,e){var n=ut(e);if("property"===n)return e.toValue();if("function"===n){if(t[0]!==p)return Mt(t,e())}else if("object"===n)return jt(e,!0);return e}var kt=function(){function t(t){void 0===t&&(t={}),this.properties={},this.set(t)}var e=t.prototype;return e.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this.raw.apply(this,t);return Mt(Ot(t),n)},e.raw=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return pt(Ot(t),this.properties)},e.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Ot(t),i=n.length;if(!i)return this;var r=pt(n,this.properties,i-1);return N(r)&&delete r[n[i-1]],this},e.set=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=this,r=e.length,s=e.slice(0,-1),a=e[r-1],o=s[0];if(1===r&&a instanceof t)i.merge(a);else if(o in m)i._set(m[o],a);else if(2===r&&O(o))i._set(o,a);else if(ot(a))mt(s)?i.set.apply(i,s.concat([at(a)])):i._set(s,a);else if(O(a))i._set(s,a);else if(N(a))for(var u in!i.has.apply(i,s)&&mt(s)&&i._set(s,{}),a)i.set.apply(i,s.concat([u,a[u]]));else if(M(a)){if(mt(s,!0)){if(dt(s)||!mt(s))this._set(s,a);else{var f=st(a);N(f)&&i.set.apply(i,s.concat([f]))}return this}var c=nt(a),h=c.styles,l=c.length;for(var u in h)i.set.apply(i,s.concat([u,h[u]]));if(l)return this;i._set(s,a)}else i._set(s,a);return i},e.getNames=function(){return ct(this.properties,[])},e.has=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Ot(t),i=n.length;return!!i&&!j(pt(n,this.properties,i))},e.clone=function(){return(new t).merge(this)},e.merge=function(t){var e=this.properties,n=t.properties;return n&&Nt(e,n),this},e.toCSSObject=function(){var t=this.get(),e={};for(var n in t)if(!mt([n],!0)){var i=t[n];n===p?e[p.replace("animation",_)]=(M(i)?i:i.easingName)||"initial":e[n]=i}var r=Dt(t.transform),s=Dt(t.filter);return C&&r&&(e[C]=r),I&&s&&(e[I]=s),e},e.toCSS=function(){var t=this.toCSSObject(),e=[];for(var n in t)e.push(n+":"+t[n]+";");return e.join("")},e._set=function(t,e){for(var n=this.properties,i=t.length,r=0;r<i-1;++r){var s=t[r];!(s in n)&&(n[s]={}),n=n[s]}if(i)if(1===i&&t[0]===p)n[p]=Ft(e);else{var a=t[i-1];n[a]=M(e)&&!dt(t)?st(e,a):e}},t}();function Pt(t,e,n,i){var r=e.length;return t.map((function(t,s){return s>=r?t:Kt(t,e[s],n,i)}))}function Ut(t,e,n,i){var r=t.type;if("color"===r)return function(t,e,n,i){var r=t.value,s=e.value,a=t.model;if(a!==e.model)return Kt(t.toValue(),e.toValue(),n,i);3===r.length&&(r[3]=1),3===s.length&&(s[3]=1);for(var o=Pt(r,s,n,i),u=a,f=0;f<3;++f)o[f]=parseInt(o[f],10);return new et(o,{type:"color",model:u,prefix:u+"(",suffix:")"})}(t,e,n,i);var s=Pt(t.value,e.value,n,i);return new et(s,{type:r,separator:t.separator||e.separator,prefix:t.prefix||e.prefix,suffix:t.suffix||e.suffix,model:t.model||e.model})}function Kt(t,e,n,i){if(0===i)return e;if(0===n||n+i===0)return t;var r=ut(t),s=ut(e),a="function"===r,o="function"===s;if(a||o)return function(){return Kt(a?st(t()):t,o?st(e()):e,n,i)};if(r!==s)return t;if("property"===r)return Ut(t,e,n,i);if("array"===r)return Pt(t,e,n,i);if("value"!==r)return t;var u,f=K(""+t),c=K(""+e);if(isNaN(f.value)||isNaN(c.value))return t;u=D(f.value,c.value,n,i);var h=f.prefix||c.prefix,l=f.unit||c.unit;return h||l?h+u+l:u}function Rt(t,e){for(var n=t.length,i=0;i<n;++i){if(t[i]===e)return[i,i];if(t[i]>e)return[i>0?i-1:0,i]}return[n-1,n-1]}function zt(t){var e=[];for(var n in t)e.push(_+"-"+z(n)+":"+t[n]+";");return e.join("")}function Lt(t,e,n){var i=t[t.length-1];(!i||i[0]!==e||i[1]!==n)&&t.push([lt(e),lt(n)])}var Vt=function(t){function n(e,n){var i=t.call(this)||this;return i.times=[],i.items={},i.names={},i.elements=[],i.needUpdate=!0,i.load(e,n),i}e(n,t);var i=n.prototype;return i.getDuration=function(){var t=this.times,e=t.length;return(0===e?0:t[e-1])||this.state.duration},i.size=function(){return this.times.length},i.setDuration=function(t){if(!t)return this;var e=this.getDuration();if(e>0){var n=t/e,i=this.times,r=this.items,s={};this.times=i.map((function(t){var e=lt(t*n);return s[e]=r[t],e})),this.items=s}else this.newFrame(t);return this},i.setId=function(t){var e=this.state;e.id=t||bt(!!length);var n=this.elements;if(n.length&&!e.selector){var i=Tt(this.getId());e.selector='[data-scene-id="'+i+'"]',n.forEach((function(t){t.setAttribute("data-scene-id",i)}))}return this},i.set=function(t){for(var e=this,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];if(t instanceof n)return this.set(0,t);if(O(t))for(var s=t.length,a=0;a<s;++a){var o=1===s?0:this.getUnitTime(a/(s-1)*100+"%");this.set(o,t[a])}else if(N(t)){var u=function(n){var i=t[n];P(n).forEach((function(t){var n=e.getUnitTime(t);isNaN(n)?ct(i,[t]).forEach((function(t){for(var n,r=pt(t.slice(1),i),s=O(r)?r:[pt(t,e.target),r],a=s.length,o=0;o<a;++o)(n=e.newFrame(o/(a-1)*100+"%")).set.apply(n,t.concat([s[o]]))})):e.set(n,i)}))};for(var o in t)u(o)}else if(!j(t)){var f=i[0];P(t+"").forEach((function(t){var r=e.getUnitTime(t);if(f instanceof n){var s=f.getDelay(),a=f.toObject(!e.hasFrame(r+s)),o=f.getDuration(),u=f.getDirection().indexOf("reverse")>-1;for(var c in a){var h=u?o-parseFloat(c):parseFloat(c);e.set(r+h,a[c])}}else if(1===i.length&&O(f))f.forEach((function(t){e.set(r,t)}));else{var l=e.newFrame(r);l.set.apply(l,i)}}))}return this.needUpdate=!0,this},i.get=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=this.getFrame(t);return i&&i.get.apply(i,e)},i.remove=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(e.length){var i=this.getFrame(t);i&&i.remove.apply(i,e)}else this.removeFrame(t);return this.needUpdate=!0,this},i.append=function(t){return t instanceof n?this.set(this.getDuration(),t):this.append(new n(t)),this},i.prepend=function(t){if(t instanceof n){var e=t.getDuration()+t.getDelay(),i=this.getFrame(0);this.removeFrame(0),this.unshift(e),this.set(0,t),this.set(e+1e-6,i)}else this.prepend(new n(t));return this},i.unshift=function(t){var e=this.times,n=this.items,i={};return this.times=e.map((function(e){var r=lt(t+e);return i[r]=n[e],r})),this.items=i,this},i.toObject=function(t){void 0===t&&(t=!0);var e={},n=this.getDelay();return this.forEach((function(i,r){e[(r||t?0:1e-6)+n+r]=i.clone()})),e},i.setSelector=function(t){return k(t)?this.setElement(t(this.getId())):this.setElement(t),this},i.getElements=function(){return this.elements},i.setElements=function(t){return this.setElement(t)},i.setElement=function(t){var e=this.state,n=[];if(!t)return this;if(!0===t||M(t)){var i=!0===t?""+e.id:t,r=/([\s\S]+)(:+[a-zA-Z]+)$/g.exec(i);n=L(X(r?r[1]:i,!0)),e.selector=i}else n=t instanceof Element?[t]:L(t);return n.length?(this.elements=n,this.setId(this.getId()),this.target=n[0].style,this.targetFunc=function(t){var i=t.get("attribute");if(i){var r=function(t){n.forEach((function(e){e.setAttribute(t,i[t])}))};for(var s in i)r(s)}if(t.has("html")){var a=t.get("html");n.forEach((function(t){t.innerHTML=a}))}var o=t.toCSS();if(e.cssText!==o)return e.cssText=o,n.forEach((function(t){t.style.cssText+=o})),t},this):this},i.setTarget=function(t){return this.target=t,this.targetFunc=function(e){var n=e.get();for(var i in n)t[i]=n[i]},this},i.setCSS=function(t,e){return this.set(t,function(t,e){if(!t||!e||!e.length)return{};var n;if(t instanceof Element)n=t;else{if(!t.length)return{};n=t[0]}for(var i={},r=window.getComputedStyle(n),s=e.length,a=0;a<s;++a)i[e[a]]=r[e[a]];return i}(this.elements,e)),this},i.setTime=function(e,n,i,r){t.prototype.setTime.call(this,e,n,i);var s=this.getIterationTime(),a=this.getEasing()||r,o=this.getNowFrame(s,a),u=this.getTime();return this.temp=o,this.trigger("animate",{frame:o,currentTime:u,time:s}),this.targetFunc&&this.targetFunc(o),this},i.update=function(){var t={};return this.forEach((function(e){ht(t,e.properties)})),this.names=t,this.needUpdate=!1,this},i.newFrame=function(t){var e=this.getFrame(t);return e||(e=new kt,this.setFrame(t,e),e)},i.setFrame=function(t,e){var n=this.getUnitTime(t);return this.items[n]=e,function(t,e){for(var n=t.length,i=0;i<n;++i)if(e<t[i])return void t.splice(i,0,e);t[n]=e}(this.times,n),this.needUpdate=!0,this},i.getFrame=function(t){return this.items[this.getUnitTime(t)]},i.removeFrame=function(t){var e=this.getUnitTime(t),n=this.items,i=this.times.indexOf(e);return delete n[e],i>-1&&this.times.splice(i,1),this.needUpdate=!0,this},i.hasFrame=function(t){return this.getUnitTime(t)in this.items},i.hasName=function(t){return this.needUpdate&&this.update(),vt(this.names,t,!0)},i.mergeFrame=function(t,e){e&&this.newFrame(t).merge(e);return this},i.getNowFrame=function(t,e,n){var i=this;this.needUpdate&&this.update();var r=new kt,s=Rt(this.times,t),a=s[0],o=s[1],u=this.getEasing()||e,f=this.names;if(this.hasName([p])){var c=this.getNowValue(t,[p],a,o,!1,0,!0);k(c)&&(u=c)}if(n){var h=ht({},this.getFrame(t).properties);for(var l in v)l in h&&(h[l]=f[l]);f=h}return ct(f,[]).forEach((function(e){var s=i.getNowValue(t,e,a,o,n,u,dt(e));j(s)||r.set(e,s)})),r},i.load=function(t,e){var n;if(void 0===t&&(t={}),void 0===e&&(e=t.options),e&&this.setOptions(e),O(t))this.set(t);else if(t.keyframes)this.set(t.keyframes);else for(var i in t)"options"!==i&&this.set(((n={})[i]=t[i],n));return e&&e.duration&&this.setDuration(e.duration),this},i.clone=function(){var t=new n;return t.setOptions(this.state),this.forEach((function(e,n){t.setFrame(n,e.clone())})),t},i.forEach=function(t){var e=this.times,n=this.items;return e.forEach((function(e){t(n[e],e,n)})),this},i.setOptions=function(e){void 0===e&&(e={}),t.prototype.setOptions.call(this,e);var n=e.id,i=e.selector,r=e.elements,s=e.element,a=e.target;return n&&this.setId(n),a?this.setTarget(a):i?this.setSelector(i):(r||s)&&this.setElement(r||s),this},i.toCSS=function(t,e,n){void 0===t&&(t={className:"startAnimation"}),void 0===e&&(e=this.getDuration()),void 0===n&&(n=[]);var i=this.state,r=i.selector;if(!r)return"";var s=this.getDuration();i.duration=s,n.push(i);var a=L(n).reverse(),o=Tt(wt(this)),u=n[0],f=$(a,(function(t){return"infinite"===t.iterationCount||!isFinite(t.duration)}),n.length-1),c=a.slice(0,f),h=e||c.reduce((function(t,e){return(e.delay+t*e.iterationCount)/e.playSpeed}),s),l=a.slice(f).reduce((function(t,e){return(t+e.delay)/e.playSpeed}),0),p=q(a,(function(t){return t.easing&&t.easingName}),i).easingName,v=a[f].iterationCount,m=u.fillMode,d=a[f].direction,g=zt({fillMode:m,direction:d,iterationCount:v,delay:l+"s",name:"__SCENEJS_KEYFRAMES_"+o,duration:h/u.playSpeed+"s",timingFunction:p}),y=P(r).map((function(t){var e=/([\s\S]+)(:+[a-zA-Z]+)$/g.exec(t);return e?[e[1],e[2]]:[t,""]})),S=t.className,E=t.selector;return"\n    "+((k(E)?E(this,r):E)||y.map((function(t){var e=t[0],n=t[1];return e+"."+S+n})))+" {"+g+"}\n    "+y.map((function(t){return t[0]+".pauseAnimation"+t[1]}))+" {"+_+"-play-state: paused;}\n    @"+A+" __SCENEJS_KEYFRAMES_"+o+"{"+this._toKeyframes(h,c,d)+"}"},i.exportCSS=function(t,e,n){if(!this.elements.length)return"";var i=this.toCSS(t,e,n);return!(n&&!j(n.iterationCount))&&Et(wt(this),i),this},i.pause=function(){return t.prototype.pause.call(this),yt(this)&&this.pauseCSS(),this},i.pauseCSS=function(){return this.elements.forEach((function(t){B(t,"pauseAnimation")})),this},i.endCSS=function(){return this.elements.forEach((function(t){G(t,"pauseAnimation"),G(t,"startAnimation")})),gt(this,!1),this},i.end=function(){return St(this)&&this.endCSS(),t.prototype.end.call(this),this},i.playCSS=function(t,e,n){return void 0===t&&(t=!0),void 0===n&&(n={}),xt(this,t,e,n),this},i.addPlayClass=function(t,e,n){void 0===n&&(n={});var i=this.elements,r=i.length,s=zt(n);if(r)return t?i.forEach((function(t){G(t,"pauseAnimation")})):i.forEach((function(t){t.style.cssText+=s,!function(t,e){return t.classList?t.classList.contains(e):!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}(t,"startAnimation")?B(t,"startAnimation"):(G(t,"startAnimation"),Z((function(){Z((function(){B(t,"startAnimation")}))})))})),i[0]},i.getNowValue=function(t,e,n,i,r,s,a){var o,u,f,c,h=this.times,l=h.length,p=j(n),v=j(i);if(p||v){var m=Rt(h,t);p&&(n=m[0]),v&&(i=m[1])}for(var d=n;d>=0;--d){if((y=this.getFrame(h[d])).has.apply(y,e)){o=h[d],f=y;break}}var g=f&&f.raw.apply(f,e);if(r&&!mt([e[0]]))return o===t?g:void 0;if(a)return g;for(d=i;d<l;++d){var y;if((y=this.getFrame(h[d])).has.apply(y,e)){u=h[d],c=y;break}}var S=c&&c.raw.apply(c,e);return!f||j(g)?S:!c||j(S)||g===S?g:function(t,e,n,i,r,s){if(t===e)return i;if(t===n)return r;if(!s)return Kt(i,r,t-e,n-t);var a=s((t-e)/(n-e));return Kt(i,r,a,1-a)}(t,Math.max(o,0),u,g,S,s)},i._toKeyframes=function(t,e,n){var i=this,r={},s=this.times.slice();if(!s.length)return"";var a=this.getDuration();!this.getFrame(0)&&s.unshift(0),!this.getFrame(a)&&s.push(a);var o=function(t,e){var n=t.map((function(t){return[t,t]})),i=[];return e.forEach((function(t){for(var e=t.iterationCount,r=t.delay,s=t.playSpeed,a=t.direction,o=Math.ceil(e),u=n[n.length-1][0],f=n.length,c=u*e,h=0;h<o;++h)for(var l="reverse"===a||"alternate"===a&&h%2||"alternate-reverse"===a&&!(h%2),p=0;p<f;++p){var v=n[l?f-p-1:p],m=v[1],d=u*h+(l?u-v[0]:v[0]),g=n[l?f-p:p-1];if(d>c){if(0!==p){var y=u*h+(l?u-g[0]:g[0]),S=D(g[1],m,c-y,d-c);Lt(i,(r+u*e)/s,S)}break}if(d===c&&i.length&&i[i.length-1][0]===c+r)break;Lt(i,(r+d)/s,m)}r&&i.unshift([0,i[0][1]]),n=i,i=[]})),n}(s,e),u=o[o.length-1];u[0]<t&&Lt(o,t,u[1]);var f=-1;return o.map((function(e){var s=e[0],o=e[1];r[o]||(r[o]=(i.hasFrame(o)&&0!==o&&o!==a?i.getNowFrame(o,0,!0):i.getNowFrame(o)).toCSS());var u=s/t*100;return u-f<1e-6&&(u+=1e-6),f=u,Math.min(u,100)+"%{\n                "+(0!==s||Ct(0,1,n)?r[o]:"")+"\n            }"})).join("")},n}(At),$t=function(){function t(){this.obj={},this.objKeys=[]}var e=t.prototype;return e.has=function(t){return t in this.obj},e.get=function(t){return this.obj[t]},e.set=function(t,e){return this.has(t)||this.objKeys.push(t),this.setItem(t,e),this},e.size=function(){return this.objKeys.length},e.keys=function(){return this.objKeys.slice()},e.values=function(){var t=this.obj;return this.objKeys.map((function(e){return t[e]}))},e.getIndex=function(t){return this.objKeys.indexOf(t)},e.findIndex=function(t){var e=this.obj;return $(this.objKeys,(function(n,i){return t(e[n],n,i,e)}))},e.find=function(t){var e=this.obj,n=q(this.objKeys,(function(n,i){return t(e[n],n,i,e)}));return e[n]},e.remove=function(t){if(this.has(t)){var e=this.getIndex(t);this.removeItem(t),this.spliceKeys(e,1)}return this},e.splice=function(t,e){for(var n=this,i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var s=i.filter((function(t){var e=t[0],i=t[1],r=n.has(e);return n.setItem(e,i),!r})),a=this.spliceKeys.apply(this,[t,e].concat(s.map((function(t){return t[0]}))));a.forEach((function(t){n.removeItem(t)}));var o=this.objKeys;return a.map((function(t){return[t,o[t]]}))},e.forEach=function(t){var e=this.obj;return this.objKeys.forEach((function(n,i){return t(e[n],n,i,e)})),this},e.setItem=function(t,e){this.obj[t]=e},e.removeItem=function(t){delete this.obj[t]},e.spliceKeys=function(t,e){for(var n,i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return(n=this.objKeys).splice.apply(n,[t,e].concat(i))},t}(),qt=function(t){function n(e,n){var i=t.call(this)||this;return i.items=new $t,i.load(e,n),i}e(n,t);var i=n.prototype;return i.getDuration=function(){var t=0;return this.forEach((function(e){t=Math.max(t,e.getTotalDuration()/e.getPlaySpeed())})),t||this.state.duration},i.setDuration=function(e){this.items;var n=this.getDuration();if(0===e||!isFinite(n))return this;if(0===n)this.forEach((function(t){t.setDuration(e)}));else{var i=e/n;this.forEach((function(t){t.setDelay(t.getDelay()*i),t.setDuration(t.getDuration()*i)}))}return t.prototype.setDuration.call(this,e),this},i.getItem=function(t){return this.items.get(t)},i.newItem=function(t,e){if(void 0===e&&(e={}),this.items.has(t))return this.items.get(t);var n=new Vt;return this.setItem(t,n),n.setOptions(e),n},i.removeItem=function(t){return this.items.remove(t),this},i.setItem=function(t,e){return e.setId(t),this.items.set(t,e),this},i.setTime=function(e,n,i,r){t.prototype.setTime.call(this,e,n,i);var s=this.getIterationTime(),a=this.getEasing()||r,o={};return this.forEach((function(t){t.setTime(s*t.getPlaySpeed()-t.getDelay(),n,!0,a),o[t.getId()]=t.temp})),this.temp=o,this.trigger("animate",{frames:o,currentTime:this.getTime(),time:s}),this},i.forEach=function(t){return this.items.forEach((function(e,n,i,r){t(e,n,i,r)})),this},i.toCSS=function(t,e,n){void 0===e&&(e=this.getDuration()),void 0===n&&(n=[]);var i=e&&isFinite(e)?e:0,r=[],s=this.state;return s.duration=this.getDuration(),this.forEach((function(e){r.push(e.toCSS(t,i,n.concat(s)))})),r.join("")},i.exportCSS=function(t,e,n){var i=this.toCSS(t,e,n);return(!n||!n.length)&&Et(wt(this),i),this},i.append=function(t){t.setDelay(t.getDelay()+this.getDuration()),this.setItem(wt(t),t)},i.pauseCSS=function(){return this.forEach((function(t){t.pauseCSS()}))},i.pause=function(){return t.prototype.pause.call(this),yt(this)&&this.pauseCSS(),this.forEach((function(t){t.pause()})),this},i.endCSS=function(){this.forEach((function(t){t.endCSS()})),gt(this,!1)},i.end=function(){return St(this)&&this.endCSS(),t.prototype.end.call(this),this},i.addPlayClass=function(t,e,n){var i;return void 0===n&&(n={}),this.forEach((function(r){var s=r.addPlayClass(t,e,n);!i&&(i=s)})),i},i.playCSS=function(t,e,n){return void 0===t&&(t=!0),void 0===n&&(n={}),xt(this,t,e,n),this},i.set=function(t){return this.load(t),this},i.load=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=t.options),!t)return this;var i=e&&e.selector||this.state.selector;for(var r in t)if("options"!==r){var s=t[r],a=void 0;if(s instanceof n||s instanceof Vt)this.setItem(r,s),a=s;else{if(k(s)&&i){for(var o=w?X(""+(k(i)?i(r):r),!0):[],u=o.length,f=new n,c=0;c<u;++c)f.newItem(c).setId().setElement(o[c]).load(s(c,o[c]));this.setItem(r,f);continue}(a=this.newItem(r)).load(s)}i&&a.setSelector(i)}this.setOptions(e)},i.setOptions=function(e){void 0===e&&(e={}),t.prototype.setOptions.call(this,e);var n=e.selector;return n&&(this.state.selector=n),this},i.setSelector=function(t){var e=this.state,n=t||e.selector;e.selector=n;var i=k(t);return n&&this.forEach((function(e,r){e.setSelector(i?t(r):n)})),this},i.start=function(e){void 0===e&&(e=this.state.delay);var n=t.prototype.start.call(this,e);return n?this.forEach((function(t){t.start(0)})):this.forEach((function(t){t.setPlayState("running")})),n},n.VERSION="1.1.6",n}(At);var Zt={SceneItem:Vt,Frame:kt,Animator:At,default:qt,OPTIONS:S,EVENTS:E,FIXED:d,ROLES:v,setRole:function(t,e,n){for(var i=t.length,r=v,s=d,a=0;a<i-1;++a)!r[t[a]]&&(r[t[a]]={}),r=r[t[a]],n&&(!s[t[a]]&&(s[t[a]]={}),s=s[t[a]]);n&&(s[t[i-1]]=!0),r[t[i-1]]=!!e||{}},setAlias:function(t,e){m[t]=e},bezier:i,steps:r,STEP_START:a,STEP_END:o,LINEAR:u,EASE:f,EASE_IN:c,EASE_OUT:h,EASE_IN_OUT:l,animate:function(t,e){return new qt(t,e).play()},animateItem:function(t,e){return new Vt(t,e).play()}};for(var Jt in Zt)qt[Jt]=Zt[Jt];return qt}));